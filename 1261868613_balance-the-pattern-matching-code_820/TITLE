Balance the pattern matching code
